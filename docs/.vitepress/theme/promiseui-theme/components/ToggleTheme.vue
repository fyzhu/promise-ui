<template>
  <div class="toggle-theme" @click="toggleTheme"
    ><svg
      t="1654493843530"
      class="icon"
      viewBox="0 0 1024 1024"
      version="1.1"
      xmlns="http://www.w3.org/2000/svg"
      p-id="2069"
      width="22"
      height="22"
      v-if="theme === 'light'"
    >
      <path
        d="M179.285333 721.578667a390.570667 390.570667 0 0 0 326.4 174.506666c214.912 0 389.162667-171.733333 389.162667-383.573333 0-187.989333-137.301333-344.704-318.848-377.344 10.666667 39.253333 16.170667 80.085333 16.170667 121.6 0 237.994667-179.882667 434.517333-412.885334 464.810667z m-69.333333-81.237334h6.570667c214.912 0 389.12-171.690667 389.12-383.573333 0-53.504-11.093333-105.386667-32.298667-153.344L446.421333 42.666667l67.242667 1.109333C772.992 48 981.333333 256.554667 981.333333 512.512 981.333333 771.456 768.384 981.333333 505.685333 981.333333c-190.890667 0-361.002667-111.872-436.053333-281.344L42.666667 639.232l67.285333 1.109333z"
        p-id="2070"
      ></path>
    </svg>
    <svg
      t="1654493960945"
      class="icon"
      viewBox="0 0 1024 1024"
      version="1.1"
      xmlns="http://www.w3.org/2000/svg"
      p-id="4844"
      width="22"
      height="22"
      v-if="theme === 'dark'"
    >
      <path
        d="M512 704c54.656-1.344 100.032-20.032 136-56S702.656 566.72 704 512c-1.344-54.656-20.032-100.032-56-136S566.72 321.344 512 320c-54.656 1.344-100.032 20.032-136 56S321.344 457.28 320 512c1.344 54.656 20.032 100.032 56 136S457.28 702.656 512 704z m0 64c-72.64-1.984-132.992-27.008-180.992-75.008S258.048 584.64 256 512c1.984-72.64 27.008-132.992 75.008-180.992S439.36 258.048 512 256c72.64 1.984 132.992 27.008 180.992 75.008S765.952 439.36 768 512c-1.984 72.64-27.008 132.992-75.008 180.992S584.64 765.952 512 768zM512 64c9.344 0 17.024 3.008 23.04 8.96 5.952 6.016 8.96 13.696 8.96 23.04v64a31.168 31.168 0 0 1-8.96 23.04A31.168 31.168 0 0 1 512 192a31.168 31.168 0 0 1-23.04-8.96 31.168 31.168 0 0 1-8.96-23.04v-64c0-9.344 3.008-17.024 8.96-23.04A31.168 31.168 0 0 1 512 64z m0 768c9.344 0 17.024 3.008 23.04 8.96 5.952 6.016 8.96 13.696 8.96 23.04v64a31.168 31.168 0 0 1-8.96 23.04A31.168 31.168 0 0 1 512 960a31.168 31.168 0 0 1-23.04-8.96 31.168 31.168 0 0 1-8.96-23.04v-64c0-9.344 3.008-17.024 8.96-23.04A31.168 31.168 0 0 1 512 832zM195.008 195.008a33.408 33.408 0 0 1 23.04-8.96c8.64 0 16 2.944 22.016 8.96l46.016 44.992c8 9.344 10.432 19.84 7.488 31.488a28.736 28.736 0 0 1-22.08 22.016 33.024 33.024 0 0 1-31.424-7.488l-45.056-46.016a29.952 29.952 0 0 1-8.96-22.016c0-8.704 3.008-16.384 8.96-23.04v0.064z m542.976 542.976a33.408 33.408 0 0 1 23.04-8.96c8.64 0 16.32 3.008 23.04 8.96l44.992 46.08c5.952 5.952 8.96 13.312 8.96 22.016a30.72 30.72 0 0 1-9.536 22.464 30.912 30.912 0 0 1-22.464 9.536 29.888 29.888 0 0 1-22.016-9.024l-46.016-44.992a33.408 33.408 0 0 1-8.96-23.04c0-8.64 2.944-16.32 8.96-22.976zM64 512c0-9.344 3.008-17.024 8.96-23.04a31.168 31.168 0 0 1 23.04-8.96h64c9.344 0 17.024 3.008 23.04 8.96 5.952 6.016 8.96 13.696 8.96 23.04a31.168 31.168 0 0 1-8.96 23.04 31.168 31.168 0 0 1-23.04 8.96h-64a31.168 31.168 0 0 1-23.04-8.96A31.168 31.168 0 0 1 64 512z m768 0c0-9.344 3.008-17.024 8.96-23.04a31.168 31.168 0 0 1 23.04-8.96h64c9.344 0 17.024 3.008 23.04 8.96 5.952 6.016 8.96 13.696 8.96 23.04a31.168 31.168 0 0 1-8.96 23.04 31.168 31.168 0 0 1-23.04 8.96h-64a31.168 31.168 0 0 1-23.04-8.96A31.168 31.168 0 0 1 832 512z m-636.992 316.992a33.408 33.408 0 0 1-8.96-23.04c0-8.64 2.944-16 8.96-22.016l44.992-46.016a33.408 33.408 0 0 1 23.04-8.96 30.72 30.72 0 0 1 22.464 9.536 30.72 30.72 0 0 1 9.472 22.464 33.408 33.408 0 0 1-8.96 23.04l-46.016 44.992a29.952 29.952 0 0 1-22.016 8.96 33.344 33.344 0 0 1-23.04-8.96h0.064z m542.976-542.976a33.408 33.408 0 0 1-8.96-23.04c0-8.64 3.008-16.32 8.96-22.976l46.08-44.992a29.952 29.952 0 0 1 22.016-8.96 30.72 30.72 0 0 1 22.464 9.472 30.912 30.912 0 0 1 9.536 22.464c0 8.704-3.008 16-9.024 22.08l-44.992 46.016a33.408 33.408 0 0 1-23.04 8.96 33.408 33.408 0 0 1-22.976-8.96v-0.064z"
        fill="#000000"
        p-id="4845"
      ></path>
    </svg>
  </div>
</template>

<script setup>
  import { onMounted, ref, watch } from 'vue'
  const theme = ref('')
  let Theme = null
  const themes = ['light', 'dark']
  onMounted(() => {
    // 引用themes,需要动态引入,否则打包报错
    // const item = localStorage.getItem('theme')
    // const localTheme = item === 'dark' ? 'dark' : 'light'
    import('../../../../../promiseui/theme').then(({ default: PTheme }) => {
      Theme = PTheme
      const themeName = localStorage.getItem('theme')

      if (themeName && themes.includes(themeName)) {
        theme.value = themeName
        Theme.use(themeName)
      }
    })
    let monaco,
      init = true
    Object.defineProperty(window, 'monaco', {
      get() {
        if (monaco && init) {
          monaco.editor.setTheme(theme.value === 'dark' ? 'iDark' : 'vs')
          init = false
        }
        return monaco
      },
      set(newValue) {
        monaco = newValue
      }
    })
  })

  watch(theme, (newTheme) => {
    if (!Theme) return
    Theme.use(newTheme)
    localStorage.setItem('theme', newTheme)
  })
  const toggleTheme = () => {
    if (!Theme) return
    theme.value = theme.value === 'dark' ? 'light' : 'dark'
    monaco && monaco.editor.setTheme(theme.value === 'dark' ? 'iDark' : 'vs')
  }
</script>

<style scoped>
  .toggle-theme {
    position: fixed;
    display: flex;
    justify-content: center;
    align-items: center;
    z-index: 999;
    width: 44px;
    height: 44px;
    font-size: 22px;
    color: #000;
    background-color: #fff;
    box-shadow: 0 3px 6px -4px #0000001f, 0 6px 16px #00000014, 0 9px 28px 8px #0000000d;
    right: 20px;
    bottom: 60px;
    border-radius: 50%;
    cursor: pointer;
  }
</style>
